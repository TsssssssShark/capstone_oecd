---
title: "survey_data_exploration"
format: html
execute: 
  echo: false
  warning: false
  message: false
  cache: false
---

## Script info

**Project:** Capstone OECD\
**Date:** 2025-10-05 **Author:** Yichu Li\
**Purpose:** Explore the survey data

## 2023 OECD Survey on Public Policy Evaluation Results

```{r}
#| label: setup-packages
#| include: false

# Check and install required packages
required_packages <- c(
  'tidyverse',
  'readxl',
  'kableExtra'
)

missing_packages <- required_packages[
  !required_packages %in% rownames(installed.packages())
]

if (length(missing_packages) > 0) {
  cat(
    "Installing missing packages:",
    paste(missing_packages, collapse = ", "),
    "\n"
  )
  install.packages(missing_packages)
}

lapply(required_packages, library, character.only = TRUE)

message('All packages loaded successfully!')
```

```{r}
#| label: load-data

data <- read_excel("survey result.xlsx", 
                   sheet = 1,
                   skip = 3
                  )

```

```{r}
#| label: data-reformat

# Re-format to correct columns and rows
data <- data %>%
  select(-2) %>%
  slice(-1) %>%
  rename(measure = 1) %>%
  select(-`...34`)

# Get country column names (all columns except 'measure')
country_cols <- names(data)[2:ncol(data)]

# Sort questions into groups
data_grouped <- data %>%
  mutate(
    # Add row ID for reference
    row_id = row_number(),
    
    # Extract question number at the beginning (e.g., "1.", "2.", "13.")
    question_number = str_extract(measure, "^[0-9]+\\."),
    
    # Mark rows that start a new group
    is_group_start = !is.na(question_number),
    
    # Create group ID based on question numbers
    group_id = question_number
  )%>%
  
  # Fill group_id downward to assign same group_id to all sub-items
  fill(group_id, .direction = 'down')

# Add main question text to each group
data_grouped <- data_grouped %>%
  group_by(group_id) %>%
  mutate(
    # Store the main question
    main_question = first(measure),
    
    # Mark position within group
    position_in_group = row_number(),
    
    # Identify if it's main or sub question
    item_type = ifelse(position_in_group == 1, 'main', 'sub')
  ) %>%
  ungroup()

# Pivot to long format
data_long <- data_grouped %>%
  pivot_longer(
    cols = all_of(country_cols),
    names_to = "country",
    values_to = "response"
  )

message('Data re-formatted!')
```

## Main Questions:

```{r}
#| label: display-main-questions

data_long %>%
  distinct(group_id, main_question) %>%
  mutate(
    Question = str_remove(main_question, "^[0-9]+\\.\\s*")
  ) %>%
  arrange(as.numeric(str_extract(group_id, "[0-9]+"))) %>%
  select(`ID` = group_id, Question) %>%
  kable(caption = "Main Survey Questions") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

### Which ones are important for our purposes?

1.  Does the government have formal definition(s) of policy evaluation ?

<!-- -->

25. Is there a national government strategy to promote the availability and accessibility of data for evaluation and evidence-informed policymaking?

<!-- -->

30. How are public policy evaluation results used?

<!-- -->

32. Are evaluation results formally discussed at the Council of Ministers or other high-level executive bodies?

\*34. Is there a central web portal where government evaluations are published?

35. Are evaluation results published in tailored and accessible formats (e.g. policy briefs, executive summaries, etc.) to promote access and use?
36. Do(es) evaluation champion(s) make use of evidence synthesis methodologies to aggregate evaluation findings and assess them in a systematic manner?

## 1. What have countries listed as formal definition?

```{r}
#| label: analyse-question-1

# Find countries answered 'Yes' in Question 1.
question1_yes <- data_long %>%
  filter(group_id == '1.', item_type == 'main') %>%
  filter(str_detect(tolower(response), 'yes')) %>%
  pull(country)

# Get Question 1.1 responses from these countries
question_1_1_responses <- data_long %>%
  filter(
    group_id == '1.',
    str_detect(measure, '1.1 Please share the definition'),
    country %in% question1_yes
  ) %>%
  select(country, measure, response)

# Display as table
question_1_1_responses %>%
  mutate(
    # Clean up the measure text to identify it as 1.1
    Question = str_sub(str_trim(measure), 1, 50)
  ) %>%
  select(Country = country, Response = response) %>%
  kable(caption = "Question 1.1 Responses from Countries that answered 'Yes' to Question 1") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE
  ) %>%
  column_spec(2, width = "30em")
  
```

### Following is what Claude summarises:

Based on the commonalities across these 19 countries, policy evaluation is: The systematic and objective assessment of government policies, programs, or activities—examining their design, implementation, and results—to determine their effectiveness, efficiency, and impact in achieving intended objectives, with the purpose of informing decision-making, ensuring accountability, and improving public management.

Core elements present across definitions:

-   **Systematic and objective** methodology

-   Assessment of **effectiveness** (achieving objectives) and efficiency (resource use)

-   Focus on **results/outcomes/impacts**

-   Purpose of **decision-making** and **improvement**

-   Evidence-based approach for **accountability**

## 34. Which countries have web portals

```{r}
#| label: analyse-question-34

# Sort by response categories
responses_34 <- data_long %>%
  filter(group_id == '34.') %>%
  select(country, response) %>%
  mutate(
    response_categories = case_when(
      is.na(response) ~ 'No Response',
      str_detect(response,'Yes') ~ 'Yes',
      str_detect(response, 'No') ~ 'No',
      str_detect(response, 'under development') ~ 'Under Development',
      TRUE ~ 'Other'
    )
  )

# Display table
responses_34 %>%
  arrange(response_categories, country) %>%
  select(Country = country, Category = response_categories) %>%
  kable(caption = "Question 34: Countries by Response Category") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
```
